import{j as f}from"./index.8620d1c0.js";const c={UpdateRoots:{added:[{}],removed:[{}],updated:[{}]},BatchedUpdate:[{}]};function p(n){let e={},r=!0;n.onDisconnect.addListener(t=>{r=!1,e={},t.onMessage.removeListener(s)});function s(t,o){!t||typeof t!="object"||typeof t.id=="number"&&e[t.id]?.forEach(a=>a(t.payload))}return n.onMessage.addListener(s),{postPortMsg(t,o){!r||n.postMessage({id:t,payload:o})},onPortMsg(t,o){if(!r)return;let a=e[t];return a||(a=e[t]=[]),a.push(o),()=>e[t]=a.filter(u=>u!==o)}}}function l(){const n={};return chrome.runtime.onMessage.addListener((e,r,s)=>{const t=e?.id;if(typeof t=="number")return n[t]?.forEach(o=>o(e.payload)),s({}),!0}),{onRuntimeMsg:(e,r)=>{let s=n[e];return s||(s=n[e]=[]),s.push(r),()=>n[e]=s.filter(t=>t!==r)},postRuntimeMessage:(e,r)=>{chrome.runtime.sendMessage({id:e,payload:r})}}}function M(){f||window.addEventListener("message",n=>{const e=n.data?.id;typeof e=="string"&&i[e]?.forEach(r=>r(n.data.payload))})}const i={};function g(n,e){let r=i[n];return r||(r=i[n]=[]),r.push(e),()=>i[n]=r.filter(s=>s!==e)}export{c as M,l as c,M as l,g as o,p};
